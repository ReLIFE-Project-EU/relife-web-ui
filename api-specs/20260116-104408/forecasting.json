{
  "openapi": "3.1.0",
  "info": {
    "title": "ReLIFE Forecasting Service",
    "description": "\nThis service evaluates the energy and thermal comfort performance of individual buildings and entire building stocks, \nproviding detailed projections for the years **2030** and **2050**.\n\n**Main objectives:**\n- Identify cost-effective renovation and retrofit strategies\n- Improve overall building performance and increase economic value\n- Significantly reduce energy demand and CO₂ emissions\n- Maximize the integration and use of renewable energy sources (RES)\n- Deliver environmental and health co-benefits, including:\n  - Reduction of greenhouse gas (GHG) emissions\n  - Decrease in heat- and cold-related illnesses and discomfort\n\nThe analysis is performed using advanced **dynamic energy simulation tools** (EnergyPlus-based) \nenhanced and calibrated within the ReLIFE project framework.\n",
    "version": "0.1.0"
  },
  "paths": {
    "/building": {
      "post": {
        "tags": ["Building and systems"],
        "summary": "Get Building Config",
        "description": "Return example BUI/System either from internal archetypes or from a custom payload.\n\n- If archetype=True: fetch BUI/system from BUILDING_ARCHETYPES by category/country/name.\n- If archetype=False: echo back the custom BUI/system passed in the request body.",
        "operationId": "get_building_config_building_post",
        "parameters": [
          {
            "name": "archetype",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "If True, use BUI/HVAC from internal archetypes; if False, use custom values from the request body.",
              "default": true,
              "title": "Archetype"
            },
            "description": "If True, use BUI/HVAC from internal archetypes; if False, use custom values from the request body."
          },
          {
            "name": "category",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Building category (Single Family House, Multi family House, office). Required when archetype=True.",
              "title": "Category"
            },
            "description": "Building category (Single Family House, Multi family House, office). Required when archetype=True."
          },
          {
            "name": "country",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Country (Italy, Greece, etc.). Required when archetype=True.",
              "title": "Country"
            },
            "description": "Country (Italy, Greece, etc.). Required when archetype=True."
          },
          {
            "name": "name",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Specific archetype name. Required when archetype=True.",
              "title": "Name"
            },
            "description": "Specific archetype name. Required when archetype=True."
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "anyOf": [
                  { "type": "object", "additionalProperties": true },
                  { "type": "null" }
                ],
                "description": "JSON body with 'bui' and 'system' when archetype=False.",
                "title": "Payload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/building/available": {
      "get": {
        "tags": ["Building and systems"],
        "summary": "List Available Archetypes",
        "description": "List available archetypes (metadata only, without full BUI/HVAC content).",
        "operationId": "list_available_archetypes_building_available_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          }
        }
      }
    },
    "/validate": {
      "post": {
        "tags": ["Validation"],
        "summary": "Validate Model",
        "description": "Validate BUI and HVAC system for either:\n  - an archetype (when archetype=True), or\n  - a custom input model provided in the request body.",
        "operationId": "validate_model_validate_post",
        "parameters": [
          {
            "name": "archetype",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "If True, validate an archetype (category+country+name). If False, validate a custom model from the body.",
              "default": true,
              "title": "Archetype"
            },
            "description": "If True, validate an archetype (category+country+name). If False, validate a custom model from the body."
          },
          {
            "name": "category",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Building category. Required when archetype=True.",
              "title": "Category"
            },
            "description": "Building category. Required when archetype=True."
          },
          {
            "name": "country",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Country. Required when archetype=True.",
              "title": "Country"
            },
            "description": "Country. Required when archetype=True."
          },
          {
            "name": "name",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Archetype name. Required when archetype=True.",
              "title": "Name"
            },
            "description": "Archetype name. Required when archetype=True."
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "anyOf": [
                  { "type": "object", "additionalProperties": true },
                  { "type": "null" }
                ],
                "description": "JSON body with 'bui' and 'system' when archetype=False.",
                "title": "Payload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/simulate": {
      "post": {
        "tags": ["Simulation"],
        "summary": "Simulate Building",
        "description": "Simulate a single building (ISO 52016 + ISO 15316) using either:\n  - an archetype (archetype=True), or\n  - a custom BUI/system configuration (archetype=False).\n\nWeather:\n  - weather_source='pvgis' → dati da PVGIS\n  - weather_source='epw'   → si carica l'EPW via epw_file (UploadFile)",
        "operationId": "simulate_building_simulate_post",
        "parameters": [
          {
            "name": "archetype",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "If True, simulate an archetype (category+country+name). If False, use custom BUI/SYSTEM.",
              "default": true,
              "title": "Archetype"
            },
            "description": "If True, simulate an archetype (category+country+name). If False, use custom BUI/SYSTEM."
          },
          {
            "name": "category",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Building category. Required when archetype=True.",
              "title": "Category"
            },
            "description": "Building category. Required when archetype=True."
          },
          {
            "name": "country",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Country. Required when archetype=True.",
              "title": "Country"
            },
            "description": "Country. Required when archetype=True."
          },
          {
            "name": "name",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Archetype name. Required when archetype=True.",
              "title": "Name"
            },
            "description": "Archetype name. Required when archetype=True."
          },
          {
            "name": "weather_source",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Weather source: 'pvgis' or 'epw'.",
              "default": "pvgis",
              "title": "Weather Source"
            },
            "description": "Weather source: 'pvgis' or 'epw'."
          }
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_simulate_building_simulate_post"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/report": {
      "post": {
        "tags": ["Reports"],
        "summary": "Generate Report",
        "description": "Generate an HTML report with hourly/monthly/annual statistical analysis\nof energy needs.\n\nInput JSON must contain:\n  - hourly_sim: list of records (rows) representing the hourly DataFrame\n  - building_area: float (m²)",
        "operationId": "generate_report_report_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "additionalProperties": true,
                "type": "object",
                "title": "Payload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "text/html": { "schema": { "type": "string" } } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/bui/epc_update_u_values": {
      "post": {
        "tags": ["Greek EPC"],
        "summary": "Update U Values",
        "description": "Update envelope U-values in the BUI according to an energy class (A/B/C/D).\n\nBehavior:\n  - If archetype=True:\n      * Load BUI/system from BUILDING_ARCHETYPES (category+country+name).\n      * Apply new U-values based on 'energy_class'.\n      * Create a NEW archetype (with 'new_name' or auto-generated name)\n        and append it to BUILDING_ARCHETYPES.\n  - If archetype=False:\n      * Read a custom BUI from the request body and modify it in-place\n        (no archetype is created).",
        "operationId": "update_u_values_bui_epc_update_u_values_post",
        "parameters": [
          {
            "name": "energy_class",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "pattern": "^[ABCD]$",
              "description": "Change U-value according to the selected energy class (A, B, C or D) for greek buildings",
              "title": "Energy Class"
            },
            "description": "Change U-value according to the selected energy class (A, B, C or D) for greek buildings"
          },
          {
            "name": "archetype",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "If True, load the BUI from an archetype (category+country+name) and create a NEW modified archetype. If False, use a custom BUI from the request body (not stored).",
              "default": true,
              "title": "Archetype"
            },
            "description": "If True, load the BUI from an archetype (category+country+name) and create a NEW modified archetype. If False, use a custom BUI from the request body (not stored)."
          },
          {
            "name": "category",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Building category (Single Family House, Multi family House, office). Required when archetype=True.",
              "title": "Category"
            },
            "description": "Building category (Single Family House, Multi family House, office). Required when archetype=True."
          },
          {
            "name": "country",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Country (Italy, Greece, etc.). Required when archetype=True.",
              "title": "Country"
            },
            "description": "Country (Italy, Greece, etc.). Required when archetype=True."
          },
          {
            "name": "name",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Name of the source archetype. Required when archetype=True.",
              "title": "Name"
            },
            "description": "Name of the source archetype. Required when archetype=True."
          },
          {
            "name": "new_name",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Name of the NEW archetype to be created. If not provided, a default name will be generated.",
              "title": "New Name"
            },
            "description": "Name of the NEW archetype to be created. If not provided, a default name will be generated."
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "anyOf": [
                  { "type": "object", "additionalProperties": true },
                  { "type": "null" }
                ],
                "description": "JSON body with 'bui' (and optionally 'system') when archetype=False.",
                "title": "Payload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/simulate/batch": {
      "post": {
        "tags": ["Simulation"],
        "summary": "Simulate Batch",
        "description": "Batch-simulate multiple buildings in parallel (multiprocessing).\n\nTwo modes are supported:\n\n  mode = \"archetype\":\n    {\n      \"mode\": \"archetype\",\n      \"category\": \"Single Family House\",\n      \"countries\": [\"Italy\", \"Greece\"],\n      \"names\": [\"SFH_Italy_default\", \"SFH_Greece_default\"]\n    }\n\n    - category: required\n    - countries: list of countries to include (required)\n    - names: list of archetype names to include (required)\n\n  mode = \"custom\":\n    {\n      \"mode\": \"custom\",\n      \"buildings\": [\n        { \"name\": \"B1\", \"bui\": {...}, \"system\": {...} },\n        { \"name\": \"B2\", \"bui\": {...}, \"system\": {...} }\n      ]\n    }\n\n    Each building must have:\n      - name\n      - bui: JSON BUI\n      - system: JSON system",
        "operationId": "simulate_batch_simulate_batch_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "additionalProperties": true,
                "type": "object",
                "title": "Payload"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/ecm_application": {
      "post": {
        "tags": ["Simulation"],
        "summary": "Simulate Uvalues",
        "description": "Seleziona un BUI da archetipo o da JSON,\ncrea copie con U-value modificati per tetto / muri / finestre\ne simula tutte le combinazioni delle migliorie richieste.",
        "operationId": "simulate_uvalues_ecm_application_post",
        "parameters": [
          {
            "name": "archetype",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "description": "Se True, usa un archetipo (category+country+name). Se False, usa un BUI custom da JSON.",
              "default": true,
              "title": "Archetype"
            },
            "description": "Se True, usa un archetipo (category+country+name). Se False, usa un BUI custom da JSON."
          },
          {
            "name": "category",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Building category. Richiesto quando archetype=True.",
              "title": "Category"
            },
            "description": "Building category. Richiesto quando archetype=True."
          },
          {
            "name": "country",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Country. Richiesto quando archetype=True.",
              "title": "Country"
            },
            "description": "Country. Richiesto quando archetype=True."
          },
          {
            "name": "name",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "string" }, { "type": "null" }],
              "description": "Archetype name. Richiesto quando archetype=True.",
              "title": "Name"
            },
            "description": "Archetype name. Richiesto quando archetype=True."
          },
          {
            "name": "weather_source",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Weather source: 'pvgis' o 'epw'.",
              "default": "pvgis",
              "title": "Weather Source"
            },
            "description": "Weather source: 'pvgis' o 'epw'."
          },
          {
            "name": "u_wall",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "number" }, { "type": "null" }],
              "description": "Nuova trasmittanza dei muri (U-value delle superfici opache verticali).",
              "title": "U Wall"
            },
            "description": "Nuova trasmittanza dei muri (U-value delle superfici opache verticali)."
          },
          {
            "name": "u_roof",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "number" }, { "type": "null" }],
              "description": "Nuova trasmittanza del tetto (U-value della superficie opaca orizzontale).",
              "title": "U Roof"
            },
            "description": "Nuova trasmittanza del tetto (U-value della superficie opaca orizzontale)."
          },
          {
            "name": "u_window",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [{ "type": "number" }, { "type": "null" }],
              "description": "Nuova trasmittanza delle finestre (U-value delle superfici trasparenti verticali).",
              "title": "U Window"
            },
            "description": "Nuova trasmittanza delle finestre (U-value delle superfici trasparenti verticali)."
          }
        ],
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_simulate_uvalues_ecm_application_post"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/emission-factors": {
      "get": {
        "tags": ["Co2 Emissions"],
        "summary": "Get Emission Factors",
        "description": "Ottieni fattori di emissione per un paese.\n\nArgs:\n    country: Codice paese (IT, EU, DE)",
        "operationId": "get_emission_factors_emission_factors_get",
        "parameters": [
          {
            "name": "country",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "default": "IT", "title": "Country" }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/calculate": {
      "post": {
        "tags": ["Co2 Emissions"],
        "summary": "Calculate Single Scenario",
        "description": "Calcola emissioni CO2eq per un singolo scenario.",
        "operationId": "calculate_single_scenario_calculate_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/ScenarioInput" }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/EmissionResult" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/compare": {
      "post": {
        "tags": ["Co2 Emissions"],
        "summary": "Compare Scenarios",
        "operationId": "compare_scenarios_compare_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/MultiScenarioInput" }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ComparisonResult" }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    },
    "/calculate-intervention": {
      "post": {
        "tags": ["Co2 Emissions"],
        "summary": "Calculate Intervention Impact",
        "description": "Calcola impatto di un intervento di riqualificazione energetica\nin termini di CO2 equivalente.",
        "operationId": "calculate_intervention_impact_calculate_intervention_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/InterventionInput" }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": { "application/json": { "schema": {} } }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HTTPValidationError" }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Body_simulate_building_simulate_post": {
        "properties": {
          "epw_file": {
            "anyOf": [
              { "type": "string", "format": "binary" },
              { "type": "null" }
            ],
            "title": "Epw File",
            "description": "EPW weather file (required when weather_source='epw')."
          },
          "bui_json": {
            "anyOf": [{ "type": "string" }, { "type": "null" }],
            "title": "Bui Json",
            "description": "JSON string with the BUI data (required when archetype=False)."
          },
          "system_json": {
            "anyOf": [{ "type": "string" }, { "type": "null" }],
            "title": "System Json",
            "description": "JSON string with the SYSTEM data (required when archetype=False)."
          }
        },
        "type": "object",
        "title": "Body_simulate_building_simulate_post"
      },
      "Body_simulate_uvalues_ecm_application_post": {
        "properties": {
          "epw_file": {
            "anyOf": [
              { "type": "string", "format": "binary" },
              { "type": "null" }
            ],
            "title": "Epw File",
            "description": "EPW weather file (richiesto quando weather_source='epw')."
          },
          "bui_json": {
            "anyOf": [{ "type": "string" }, { "type": "null" }],
            "title": "Bui Json",
            "description": "JSON string con il BUI (richiesto quando archetype=False)."
          }
        },
        "type": "object",
        "title": "Body_simulate_uvalues_ecm_application_post"
      },
      "ComparisonResult": {
        "properties": {
          "baseline": { "$ref": "#/components/schemas/EmissionResult" },
          "scenarios": {
            "items": { "$ref": "#/components/schemas/EmissionResult" },
            "type": "array",
            "title": "Scenarios"
          },
          "best_scenario": { "type": "string", "title": "Best Scenario" },
          "savings": {
            "items": { "$ref": "#/components/schemas/SavingResult" },
            "type": "array",
            "title": "Savings"
          }
        },
        "type": "object",
        "required": ["baseline", "scenarios", "best_scenario", "savings"],
        "title": "ComparisonResult",
        "description": "Risultato confronto scenari"
      },
      "EmissionResult": {
        "properties": {
          "name": { "type": "string", "title": "Name" },
          "energy_source": { "type": "string", "title": "Energy Source" },
          "annual_consumption_kwh": {
            "type": "number",
            "title": "Annual Consumption Kwh"
          },
          "emission_factor_kg_per_kwh": {
            "type": "number",
            "title": "Emission Factor Kg Per Kwh"
          },
          "annual_emissions_kg_co2eq": {
            "type": "number",
            "title": "Annual Emissions Kg Co2Eq"
          },
          "annual_emissions_ton_co2eq": {
            "type": "number",
            "title": "Annual Emissions Ton Co2Eq"
          },
          "equivalent_trees": {
            "type": "integer",
            "title": "Equivalent Trees"
          },
          "equivalent_km_car": {
            "type": "integer",
            "title": "Equivalent Km Car"
          }
        },
        "type": "object",
        "required": [
          "name",
          "energy_source",
          "annual_consumption_kwh",
          "emission_factor_kg_per_kwh",
          "annual_emissions_kg_co2eq",
          "annual_emissions_ton_co2eq",
          "equivalent_trees",
          "equivalent_km_car"
        ],
        "title": "EmissionResult",
        "description": "Risultato calcolo emissioni"
      },
      "EnergySource": {
        "type": "string",
        "enum": [
          "grid_electricity",
          "natural_gas",
          "lpg",
          "diesel",
          "biomass",
          "district_heating",
          "solar_pv",
          "wind",
          "heat_pump_electric"
        ],
        "title": "EnergySource",
        "description": "Fonti energetiche disponibili"
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": { "$ref": "#/components/schemas/ValidationError" },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "InterventionInput": {
        "properties": {
          "current_consumption_kwh": {
            "type": "number",
            "exclusiveMinimum": 0.0,
            "title": "Current Consumption Kwh",
            "description": "Consumo attuale [kWh/anno]"
          },
          "current_source": {
            "$ref": "#/components/schemas/EnergySource",
            "description": "Fonte energetica attuale"
          },
          "energy_reduction_percentage": {
            "type": "number",
            "maximum": 100.0,
            "minimum": 0.0,
            "title": "Energy Reduction Percentage",
            "description": "Riduzione percentuale dei consumi (es. 30 = -30%)",
            "default": 0
          },
          "new_source": {
            "anyOf": [
              { "$ref": "#/components/schemas/EnergySource" },
              { "type": "null" }
            ],
            "description": "Nuova fonte energetica (se None, resta quella attuale)"
          },
          "new_consumption_kwh": {
            "anyOf": [{ "type": "number" }, { "type": "null" }],
            "title": "New Consumption Kwh",
            "description": "Nuovo consumo annuo. Se None, calcolato dalla riduzione percentuale."
          },
          "country": {
            "type": "string",
            "title": "Country",
            "description": "Codice paese per i fattori di emissione (IT, EU, DE)",
            "default": "IT"
          }
        },
        "type": "object",
        "required": ["current_consumption_kwh", "current_source"],
        "title": "InterventionInput",
        "description": "Input per valutare un intervento di riqualificazione",
        "example": {
          "country": "IT",
          "current_consumption_kwh": 20000,
          "current_source": "natural_gas",
          "energy_reduction_percentage": 30,
          "new_consumption_kwh": 5000,
          "new_source": "heat_pump_electric"
        }
      },
      "MultiScenarioInput": {
        "properties": {
          "scenarios": {
            "items": { "$ref": "#/components/schemas/ScenarioInput" },
            "type": "array",
            "maxItems": 10,
            "minItems": 1,
            "title": "Scenarios"
          }
        },
        "type": "object",
        "required": ["scenarios"],
        "title": "MultiScenarioInput",
        "description": "Input per confronto multiplo",
        "example": {
          "scenarios": [
            {
              "annual_consumption_kwh": 20000,
              "country": "IT",
              "energy_source": "natural_gas",
              "name": "Scenario Attuale - Caldaia Gas"
            },
            {
              "annual_consumption_kwh": 5000,
              "country": "IT",
              "energy_source": "heat_pump_electric",
              "name": "Scenario 1 - Pompa di Calore"
            },
            {
              "annual_consumption_kwh": 5000,
              "country": "IT",
              "energy_source": "solar_pv",
              "name": "Scenario 2 - PdC + Fotovoltaico"
            }
          ]
        }
      },
      "SavingResult": {
        "properties": {
          "scenario_name": { "type": "string", "title": "Scenario Name" },
          "absolute_kg_co2eq": {
            "type": "number",
            "title": "Absolute Kg Co2Eq"
          },
          "absolute_ton_co2eq": {
            "type": "number",
            "title": "Absolute Ton Co2Eq"
          },
          "percentage": { "type": "number", "title": "Percentage" }
        },
        "type": "object",
        "required": [
          "scenario_name",
          "absolute_kg_co2eq",
          "absolute_ton_co2eq",
          "percentage"
        ],
        "title": "SavingResult",
        "description": "Risultato di risparmio rispetto al baseline per uno scenario"
      },
      "ScenarioInput": {
        "properties": {
          "name": {
            "type": "string",
            "title": "Name",
            "description": "Nome dello scenario"
          },
          "energy_source": {
            "$ref": "#/components/schemas/EnergySource",
            "description": "Fonte energetica"
          },
          "annual_consumption_kwh": {
            "type": "number",
            "exclusiveMinimum": 0.0,
            "title": "Annual Consumption Kwh",
            "description": "Consumo annuale [kWh]"
          },
          "country": {
            "type": "string",
            "title": "Country",
            "description": "Codice paese (IT, EU, DE)",
            "default": "IT"
          }
        },
        "type": "object",
        "required": ["name", "energy_source", "annual_consumption_kwh"],
        "title": "ScenarioInput",
        "description": "Input per calcolo singolo scenario",
        "example": {
          "annual_consumption_kwh": 20000,
          "country": "IT",
          "energy_source": "natural_gas",
          "name": "Caldaia Gas Esistente"
        }
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": { "anyOf": [{ "type": "string" }, { "type": "integer" }] },
            "type": "array",
            "title": "Location"
          },
          "msg": { "type": "string", "title": "Message" },
          "type": { "type": "string", "title": "Error Type" }
        },
        "type": "object",
        "required": ["loc", "msg", "type"],
        "title": "ValidationError"
      }
    }
  }
}
