{
  "openapi": "3.1.0",
  "info": {
    "title": "ReLIFE Forecasting Service",
    "description": "ReLIFE service for building energy forecasting",
    "version": "0.1.0"
  },
  "paths": {
    "/health": {
      "get": {
        "tags": ["health"],
        "summary": "Health Check",
        "description": "Basic health check endpoint that returns service status and current timestamp.",
        "operationId": "health_check_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/whoami": {
      "get": {
        "tags": ["auth"],
        "summary": "Whoami With Roles",
        "description": "Return authenticated user's information including their Keycloak roles.",
        "operationId": "whoami_with_roles_whoami_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthenticatedUser"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/storage": {
      "get": {
        "tags": ["examples"],
        "summary": "List Files",
        "description": "List all files uploaded by the authenticated user to the default Supabase Storage bucket.\n\nThis endpoint retrieves a comprehensive list of all files that the current user\nhas uploaded to their personal storage folder. Each file entry includes metadata\nsuch as size, creation date, and public access URL.",
        "operationId": "list_files_storage_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "items": {
                    "$ref": "#/components/schemas/StorageFileInfo"
                  },
                  "type": "array",
                  "title": "Response List Files Storage Get"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      },
      "post": {
        "tags": ["examples"],
        "summary": "Upload File",
        "description": "Upload a file to Supabase Storage with user-specific organization.\n\nThis endpoint uploads files to a user-specific folder within the configured storage bucket.\nEach user's files are isolated in their own directory to prevent unauthorized access.",
        "operationId": "upload_file_storage_post",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_upload_file_storage_post"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FileUploadResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/table/{table_name}": {
      "get": {
        "tags": ["examples"],
        "summary": "Read Table",
        "description": "Read data from a Supabase table. The table name is passed as a path parameter.\n\nThis endpoint respects Row Level Security (RLS) policies configured on the table.\nUsers will only see data they are authorized to access based on their permissions.",
        "operationId": "read_table_table__table_name__get",
        "security": [
          {
            "HTTPBearer": []
          }
        ],
        "parameters": [
          {
            "name": "table_name",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Table Name"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TableDataResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/user-profile": {
      "get": {
        "tags": ["examples"],
        "summary": "Get User Profile",
        "description": "Get comprehensive user profile information including Keycloak roles.\n\nThis endpoint demonstrates how to work with users authenticated via Keycloak\nwithout requiring them to be present in Supabase. It shows how to access\nuser information and roles from the Keycloak authentication context.\n\nThis works with both Supabase-synchronized and direct Keycloak users.",
        "operationId": "get_user_profile_user_profile_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Get User Profile User Profile Get"
                }
              }
            }
          }
        },
        "security": [
          {
            "HTTPBearer": []
          }
        ]
      }
    },
    "/project": {
      "post": {
        "tags": ["forecasting"],
        "summary": "Create Project",
        "operationId": "create_project_project_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "type": "string"
                  },
                  "type": "object",
                  "title": "Response Create Project Project Post"
                }
              }
            }
          }
        }
      }
    },
    "/project/{project_id}/building": {
      "put": {
        "tags": ["forecasting"],
        "summary": "Upload Building",
        "operationId": "upload_building_project__project_id__building_put",
        "parameters": [
          {
            "name": "project_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Project Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BuildingPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/plant/template": {
      "get": {
        "tags": ["forecasting"],
        "summary": "Get Plant Template",
        "operationId": "get_plant_template_plant_template_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/project/{project_id}/plant": {
      "put": {
        "tags": ["forecasting"],
        "summary": "Upload Plant",
        "operationId": "upload_plant_project__project_id__plant_put",
        "parameters": [
          {
            "name": "project_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Project Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PlantPayload"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/project/{project_id}/simulate": {
      "post": {
        "tags": ["forecasting"],
        "summary": "Simulate Project",
        "operationId": "simulate_project_project__project_id__simulate_post",
        "parameters": [
          {
            "name": "project_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Project Id"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_simulate_project_project__project_id__simulate_post"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/project/{project_id}/results.csv": {
      "get": {
        "tags": ["forecasting"],
        "summary": "Download Results Csv",
        "operationId": "download_results_csv_project__project_id__results_csv_get",
        "parameters": [
          {
            "name": "project_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Project Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/project/{project_id}/epc": {
      "get": {
        "tags": ["forecasting"],
        "summary": "Get Epc",
        "operationId": "get_epc_project__project_id__epc_get",
        "parameters": [
          {
            "name": "project_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Project Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "AuthenticatedUser": {
        "properties": {
          "token": {
            "type": "string",
            "title": "Token"
          },
          "user": {
            "$ref": "#/components/schemas/UniversalUser"
          },
          "authentication_method": {
            "$ref": "#/components/schemas/AuthenticationMethod"
          },
          "keycloak_roles": {
            "anyOf": [
              {
                "items": {
                  "$ref": "#/components/schemas/KeycloakRole"
                },
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "title": "Keycloak Roles"
          }
        },
        "type": "object",
        "required": ["token", "user", "authentication_method"],
        "title": "AuthenticatedUser",
        "description": "Authenticated user model supporting multiple authentication providers.\n\nThis model abstracts authentication information from various sources (Supabase, Keycloak)\nand provides a consistent interface for user data and permissions."
      },
      "AuthenticationMethod": {
        "type": "string",
        "enum": ["supabase", "keycloak"],
        "title": "AuthenticationMethod",
        "description": "Authentication method used to authenticate the user."
      },
      "Body_simulate_project_project__project_id__simulate_post": {
        "properties": {
          "epw": {
            "type": "string",
            "format": "binary",
            "title": "Epw"
          }
        },
        "type": "object",
        "required": ["epw"],
        "title": "Body_simulate_project_project__project_id__simulate_post"
      },
      "Body_upload_file_storage_post": {
        "properties": {
          "file": {
            "type": "string",
            "format": "binary",
            "title": "File"
          }
        },
        "type": "object",
        "required": ["file"],
        "title": "Body_upload_file_storage_post"
      },
      "BuildingPayload": {
        "properties": {
          "data": {
            "additionalProperties": true,
            "type": "object",
            "title": "Data",
            "description": "Dizionario con parametri geometrici/termici. Esempio chiavi: \n- area_m2 (float)\n- volume_m3 (float)\n- U_envelope_W_m2K (float)\n- infiltration_ach (float/h)\n- internal_gains_W (float)\n- thermal_capacity_kJ_K (float)\n",
            "examples": [
              {
                "U_envelope_W_m2K": 0.7,
                "area_m2": 100.0,
                "infiltration_ach": 0.5,
                "internal_gains_W": 500.0,
                "thermal_capacity_kJ_K": 80000.0,
                "volume_m3": 250.0
              }
            ]
          }
        },
        "type": "object",
        "required": ["data"],
        "title": "BuildingPayload"
      },
      "FileUploadResponse": {
        "properties": {
          "message": {
            "type": "string",
            "title": "Message"
          },
          "path": {
            "type": "string",
            "title": "Path"
          },
          "public_url": {
            "type": "string",
            "title": "Public Url"
          }
        },
        "type": "object",
        "required": ["message", "path", "public_url"],
        "title": "FileUploadResponse",
        "description": "Response model for file upload endpoint."
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "KeycloakRole": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "name": {
            "type": "string",
            "title": "Name"
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Description"
          },
          "composite": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Composite"
          },
          "clientRole": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Clientrole"
          },
          "containerId": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Containerid"
          }
        },
        "type": "object",
        "required": ["id", "name"],
        "title": "KeycloakRole",
        "description": "Representation of a Keycloak role with its attributes.\n\nThis model represents role information retrieved from Keycloak's identity provider."
      },
      "PlantPayload": {
        "properties": {
          "data": {
            "additionalProperties": true,
            "type": "object",
            "title": "Data",
            "description": "Dizionario impianto. Esempio chiavi: \n- heat_setpoint_C (float)\n- cool_setpoint_C (float)\n- heat_power_max_W (float)\n- cool_power_max_W (float)\n- heat_efficiency (float, 0-1 o COP)\n- cool_efficiency (float, 0-1 o EER)\n",
            "examples": [
              {
                "cool_efficiency": 3.0,
                "cool_power_max_W": 6000.0,
                "cool_setpoint_C": 26.0,
                "heat_efficiency": 0.95,
                "heat_power_max_W": 6000.0,
                "heat_setpoint_C": 20.0
              }
            ]
          }
        },
        "type": "object",
        "required": ["data"],
        "title": "PlantPayload"
      },
      "StorageFileInfo": {
        "properties": {
          "name": {
            "type": "string",
            "title": "Name"
          },
          "size": {
            "type": "integer",
            "title": "Size"
          },
          "created_at": {
            "type": "string",
            "title": "Created At"
          },
          "public_url": {
            "type": "string",
            "title": "Public Url"
          }
        },
        "type": "object",
        "required": ["name", "size", "created_at", "public_url"],
        "title": "StorageFileInfo",
        "description": "Model representing information about a stored file."
      },
      "TableDataResponse": {
        "properties": {
          "table_name": {
            "type": "string",
            "title": "Table Name"
          },
          "data": {
            "items": {
              "additionalProperties": true,
              "type": "object"
            },
            "type": "array",
            "title": "Data"
          },
          "count": {
            "type": "integer",
            "title": "Count"
          }
        },
        "type": "object",
        "required": ["table_name", "data", "count"],
        "title": "TableDataResponse",
        "description": "Response model for table read endpoint."
      },
      "UniversalUser": {
        "properties": {
          "id": {
            "type": "string",
            "title": "Id"
          },
          "email": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Email"
          },
          "user_metadata": {
            "additionalProperties": {
              "type": "string"
            },
            "type": "object",
            "title": "User Metadata",
            "default": {}
          },
          "identities": {
            "items": {
              "$ref": "#/components/schemas/UserIdentity"
            },
            "type": "array",
            "title": "Identities",
            "default": []
          }
        },
        "type": "object",
        "required": ["id"],
        "title": "UniversalUser",
        "description": "Provider-agnostic user model that works with any authentication provider.\n\nThis model abstracts away the differences between Supabase GoTrue User objects\nand Keycloak JWT payloads, providing a consistent interface for user data\nregardless of the authentication provider."
      },
      "UserIdentity": {
        "properties": {
          "provider": {
            "type": "string",
            "title": "Provider"
          },
          "id": {
            "type": "string",
            "title": "Id"
          }
        },
        "type": "object",
        "required": ["provider", "id"],
        "title": "UserIdentity",
        "description": "Represents a user identity from an authentication provider."
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": ["loc", "msg", "type"],
        "title": "ValidationError"
      }
    },
    "securitySchemes": {
      "HTTPBearer": {
        "type": "http",
        "scheme": "bearer"
      }
    }
  }
}
